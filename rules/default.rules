var Number luminanceThreshold = 180

rule "Ceiling_Light ON"
when
    Item Ceiling_Sensor_Motion changed from OFF to ON or
    Item Door_Sensor_Contact changed from CLOSED to OPEN 
then
    if(Ceiling_Sensor_Luminance.state < luminanceThreshold and Ceiling_Light.state > 0){
        Ceiling_Light.sendCommand(ON)
        logInfo("Ceiling_Light.ON", "Ceiling_Light open on trigger")
    }else{
        logInfo("Ceiling_Light.ON", "Rule has run but Luminance is high: " + Ceiling_Sensor_Luminance.state + " is higher than " + luminanceThreshold)
    }
end

rule "Door_Sensor_Contact OFF"
when
    Item Door_Sensor_Contact changed from OPEN to CLOSED
then
    logInfo("Door_Sensor_Contact.OFF", "Door_Sensor_Contact closed")
    Ceiling_Sensor_Motion.sendCommand(OFF)
end


rule "Ceiling_Light OFF on timer"
when
    Time cron "0/30 * * ? * * *" //30 seconds
then
    logInfo("Ceiling_Light.OFF.timer", "Each 30 seconds TRY")
    if(Ceiling_Sensor_Motion.state == ON){
        Ceiling_Sensor_Motion.sendCommand(OFF)
        logInfo("Ceiling_Light.OFF.timer", "Ceiling_Light closed each hour")
    }else{
        if (Ceiling_Light.state > 0) {
            logInfo("Ceiling_Light.OFF.timer", "Ceiling_Light closed each hour")
            Ceiling_Light.sendCommand(0)
        }
    }
end
